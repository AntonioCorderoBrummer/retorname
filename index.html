<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Ret√≥rname ‚Äì Recoge. Retorna. Reparte.</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,400;0,600;0,700;0,800;0,900;1,700&family=Nunito+Sans:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { box-sizing:border-box; margin:0; padding:0; }
    :root {
      --g1: #1a7a2e;   /* verde oscuro logo */
      --g2: #4cbb3a;   /* verde claro logo */
      --b1: #5bb8e8;   /* azul cielo */
      --b2: #1a3a6b;   /* azul marino */
      --white: #ffffff;
      --light: #f0f8f2;
      --light2: #e6f4ff;
      --text: #1a2b1e;
      --muted: #5a7060;
      --border: #c8e6cf;
      --radius: 16px;
      --shadow: 0 6px 28px rgba(26,122,46,.13);
      --shadow-b: 0 6px 28px rgba(26,58,107,.13);
    }
    html { scroll-behavior:smooth; }
    body {
      font-family:'Nunito Sans', sans-serif;
      background:var(--light);
      color:var(--text);
      min-height:100vh;
    }

    /* ‚îÄ‚îÄ NAV ‚îÄ‚îÄ */
    nav {
      position:sticky; top:0; z-index:200;
      background:var(--g1);
      display:flex; align-items:center; justify-content:space-between;
      padding:0 2rem; height:68px;
      box-shadow:0 3px 18px rgba(0,0,0,.18);
    }
    .logo-wrap { display:flex; align-items:center; gap:.8rem; }
    .logo-icon-wrap {
      width:44px; height:44px; border-radius:50%;
      background:white; display:flex; align-items:center; justify-content:center;
      box-shadow:0 2px 8px rgba(0,0,0,.15);
    }
    .logo-svg { width:32px; height:32px; }
    .logo-name {
      font-family:'Nunito', sans-serif;
      font-size:1.6rem; font-weight:900; font-style:italic;
      color:white; letter-spacing:-.02em;
    }
    .logo-name span { color:var(--b1); }
    .nav-slogan {
      font-family:'Nunito', sans-serif;
      font-size:.72rem; font-weight:700; letter-spacing:.12em;
      color:rgba(255,255,255,.75); text-transform:uppercase;
    }
    .beta-tag {
      background:var(--b1); color:var(--b2);
      font-size:.65rem; font-weight:800; letter-spacing:.1em;
      padding:.3rem .7rem; border-radius:999px; text-transform:uppercase;
    }

    /* ‚îÄ‚îÄ HERO ‚îÄ‚îÄ */
    .hero {
      background: linear-gradient(160deg, var(--g1) 0%, #145a22 45%, var(--b2) 100%);
      color:white; text-align:center;
      padding:5.5rem 1.5rem 4.5rem;
      position:relative; overflow:hidden;
    }
    .hero::before {
      content:'';
      position:absolute; inset:0;
      background:
        radial-gradient(ellipse at 80% 20%, rgba(91,184,232,.22) 0%, transparent 55%),
        radial-gradient(ellipse at 10% 80%, rgba(76,187,58,.18) 0%, transparent 50%);
    }
    .hero-bottles {
      position:absolute; bottom:0; left:0; right:0;
      height:90px; opacity:.08;
      background:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 120 90'%3E%3Crect x='10' y='20' width='18' height='65' rx='5' fill='white'/%3E%3Crect x='35' y='10' width='14' height='75' rx='4' fill='white'/%3E%3Crect x='56' y='25' width='20' height='60' rx='5' fill='white'/%3E%3Crect x='84' y='15' width='16' height='70' rx='4' fill='white'/%3E%3C/svg%3E") repeat-x bottom;
    }
    .hero-tag {
      display:inline-flex; align-items:center; gap:.5rem;
      background:rgba(255,255,255,.12); border:1px solid rgba(255,255,255,.3);
      color:rgba(255,255,255,.95); font-size:.8rem; font-weight:700;
      padding:.4rem 1.1rem; border-radius:999px; margin-bottom:1.6rem;
      letter-spacing:.06em; text-transform:uppercase;
      backdrop-filter:blur(8px);
    }
    .hero h1 {
      font-family:'Nunito', sans-serif;
      font-size:clamp(2.2rem, 5.5vw, 3.8rem);
      font-weight:900; line-height:1.1; margin-bottom:1.2rem;
      font-style:italic;
    }
    .hero h1 .accent { color:var(--b1); }
    .hero h1 .accent2 { color:var(--g2); }
    .hero p {
      max-width:540px; margin:0 auto 2.4rem;
      font-size:1.05rem; color:rgba(255,255,255,.8); line-height:1.75;
      font-weight:600;
    }
    .slogan-hero {
      display:inline-flex; gap:0; margin-bottom:2rem;
    }
    .slogan-part {
      padding:.45rem 1.1rem;
      font-family:'Nunito', sans-serif;
      font-size:.85rem; font-weight:800; letter-spacing:.05em;
      text-transform:uppercase;
    }
    .slogan-part:nth-child(1) { background:var(--g2); color:white; border-radius:8px 0 0 8px; }
    .slogan-part:nth-child(2) { background:var(--b1); color:var(--b2); }
    .slogan-part:nth-child(3) { background:var(--b2); color:white; border-radius:0 8px 8px 0; }
    .hero-cta {
      display:inline-flex; align-items:center; gap:.6rem;
      background:white; color:var(--g1);
      font-family:'Nunito', sans-serif;
      font-weight:900; font-size:1rem;
      padding:.9rem 2.4rem; border-radius:999px;
      text-decoration:none;
      transition:transform .2s, box-shadow .2s;
      box-shadow:0 4px 24px rgba(0,0,0,.2);
    }
    .hero-cta:hover { transform:translateY(-3px); box-shadow:0 8px 32px rgba(0,0,0,.25); }

    /* ‚îÄ‚îÄ STEPS BAR ‚îÄ‚îÄ */
    .steps-bar {
      background:white;
      border-bottom:3px solid var(--g2);
      padding:1rem 1rem;
      position:sticky; top:68px; z-index:90;
    }
    .steps-track { max-width:820px; margin:0 auto; display:flex; align-items:center; }
    .step-item { flex:1; display:flex; flex-direction:column; align-items:center; gap:.3rem; position:relative; }
    .step-item:not(:last-child)::after {
      content:''; position:absolute; top:17px; left:50%; width:100%; height:3px;
      background:#dde8e0; z-index:-1; transition:background .4s;
    }
    .step-item.completed:not(:last-child)::after { background:var(--g2); }
    .step-dot {
      width:34px; height:34px; border-radius:50%;
      display:flex; align-items:center; justify-content:center;
      font-family:'Nunito', sans-serif; font-weight:800; font-size:.82rem;
      background:#dde8e0; color:var(--muted);
      transition:all .3s; border:2px solid transparent;
    }
    .step-item.active .step-dot { background:var(--g1); color:white; border-color:var(--g2); transform:scale(1.15); }
    .step-item.completed .step-dot { background:var(--g2); color:white; }
    .step-label { font-size:.65rem; font-weight:700; color:var(--muted); text-align:center; text-transform:uppercase; letter-spacing:.04em; }
    .step-item.active .step-label   { color:var(--g1); }
    .step-item.completed .step-label { color:var(--g2); }

    /* ‚îÄ‚îÄ FORM CONTAINER ‚îÄ‚îÄ */
    .form-container { max-width:740px; margin:2.5rem auto; padding:0 1rem 4rem; }

    /* ‚îÄ‚îÄ CARD ‚îÄ‚îÄ */
    .card {
      background:white; border-radius:var(--radius);
      box-shadow:var(--shadow); padding:2rem 2.2rem;
      margin-bottom:1.5rem; display:none;
      animation:fadeUp .4s ease; border-top:4px solid var(--g2);
    }
    .card.visible { display:block; }
    @keyframes fadeUp { from{opacity:0;transform:translateY(18px)} to{opacity:1;transform:none} }
    .card-header { display:flex; align-items:center; gap:1rem; margin-bottom:1.6rem; padding-bottom:1.2rem; border-bottom:2px solid var(--light); }
    .card-num {
      width:42px; height:42px; flex-shrink:0; border-radius:12px;
      background:linear-gradient(135deg,var(--g1),var(--g2));
      color:white; font-family:'Nunito',sans-serif; font-weight:900; font-size:1.2rem;
      display:flex; align-items:center; justify-content:center;
    }
    .card-title { font-family:'Nunito',sans-serif; font-size:1.2rem; font-weight:800; color:var(--g1); }
    .card-sub   { font-size:.83rem; color:var(--muted); margin-top:.15rem; }

    /* ‚îÄ‚îÄ FORM ELEMENTS ‚îÄ‚îÄ */
    label { display:block; font-weight:700; font-size:.88rem; margin-bottom:.45rem; color:var(--text); }
    .hint { font-size:.77rem; color:var(--muted); margin-bottom:.6rem; }
    input[type="text"], select {
      width:100%; padding:.8rem 1.1rem;
      border:2px solid var(--border); border-radius:10px;
      font-size:.95rem; font-family:'Nunito Sans',inherit;
      background:#fafffe; color:var(--text);
      transition:border-color .2s, box-shadow .2s; outline:none;
    }
    input:focus, select:focus {
      border-color:var(--g1); box-shadow:0 0 0 4px rgba(26,122,46,.1); background:white;
    }

    /* ‚îÄ‚îÄ SUPERMARKET GRID ‚îÄ‚îÄ */
    .super-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(128px,1fr)); gap:.8rem; margin-top:.5rem; }
    .super-card {
      border:2.5px solid var(--border); border-radius:12px;
      padding:1rem .8rem; text-align:center; cursor:pointer;
      transition:all .2s; background:#fafffe;
    }
    .super-card:hover { border-color:var(--g2); background:var(--light); transform:translateY(-2px); }
    .super-card.selected {
      border-color:var(--g1); background:var(--light);
      box-shadow:0 0 0 3px rgba(26,122,46,.18);
      transform:translateY(-2px);
    }
    .super-icon { font-size:1.8rem; margin-bottom:.4rem; }
    .super-name { font-size:.78rem; font-weight:800; color:var(--text); font-family:'Nunito',sans-serif; }
    .super-check { display:none; color:var(--g1); font-size:.78rem; margin-top:.2rem; font-weight:800; }
    .super-card.selected .super-check { display:block; }

    /* ‚îÄ‚îÄ BOTTLE COUNTER ‚îÄ‚îÄ */
    .counter-row { display:flex; align-items:center; gap:1.2rem; margin-top:.6rem; }
    .counter-btn {
      width:48px; height:48px; border-radius:50%;
      border:2.5px solid var(--g1); background:white; color:var(--g1);
      font-size:1.5rem; cursor:pointer; font-family:'Nunito',sans-serif; font-weight:900;
      display:flex; align-items:center; justify-content:center;
      transition:all .18s; line-height:1;
    }
    .counter-btn:hover { background:var(--g1); color:white; transform:scale(1.08); }
    .counter-display {
      font-family:'Nunito',sans-serif;
      font-size:2.6rem; font-weight:900; color:var(--g1);
      min-width:64px; text-align:center; line-height:1;
    }
    .counter-label { font-size:.85rem; color:var(--muted); font-weight:600; }
    .bottles-info {
      margin-top:1.2rem; padding:1rem 1.1rem;
      background:linear-gradient(135deg,var(--light),#e8f5e0);
      border:1.5px solid var(--border); border-left:4px solid var(--g2);
      border-radius:10px; font-size:.86rem; color:var(--g1); font-weight:700;
    }

    /* ‚îÄ‚îÄ BEVERAGE PICKER ‚îÄ‚îÄ */
    .bev-group { margin-bottom:1.4rem; }
    .bev-group-label { font-size:.72rem; font-weight:800; text-transform:uppercase; letter-spacing:.08em; color:var(--muted); margin-bottom:.5rem; font-family:'Nunito',sans-serif; }
    .bev-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(112px,1fr)); gap:.6rem; }
    .bev-card {
      border:2.5px solid var(--border); border-radius:10px;
      padding:.8rem .5rem; text-align:center; cursor:pointer;
      transition:all .18s; background:#fafffe; position:relative;
    }
    .bev-card:hover { border-color:var(--b1); background:var(--light2); }
    .bev-card.pick-1 { border-color:var(--g1); background:var(--light); }
    .bev-card.pick-2 { border-color:var(--b1); background:var(--light2); }
    .bev-card.pick-3 { border-color:var(--b2); background:#edf1ff; }
    .bev-icon { font-size:1.55rem; }
    .bev-name { font-size:.73rem; font-weight:700; margin-top:.3rem; color:var(--text); font-family:'Nunito',sans-serif; }
    .bev-badge {
      position:absolute; top:-7px; right:-7px;
      width:21px; height:21px; border-radius:50%;
      font-size:.65rem; font-weight:900; color:white;
      display:flex; align-items:center; justify-content:center;
      font-family:'Nunito',sans-serif;
    }
    .pick-1 .bev-badge { background:var(--g1); }
    .pick-2 .bev-badge { background:var(--b1); }
    .pick-3 .bev-badge { background:var(--b2); }
    .bev-legend { display:flex; gap:1rem; margin-bottom:.9rem; flex-wrap:wrap; }
    .legend-item { display:flex; align-items:center; gap:.4rem; font-size:.78rem; color:var(--muted); font-weight:600; }
    .legend-dot { width:13px; height:13px; border-radius:50%; }

    /* ‚îÄ‚îÄ ADDRESS ‚îÄ‚îÄ */
    .address-block { margin-bottom:1.4rem; }
    .address-icon { font-size:1.2rem; margin-right:.35rem; }
    .same-address {
      display:flex; align-items:center; gap:.55rem;
      background:var(--light); border:1.5px solid var(--border);
      border-radius:10px; padding:.75rem 1rem; cursor:pointer; margin-top:.8rem;
    }
    .same-address input[type="checkbox"] { width:17px; height:17px; accent-color:var(--g1); cursor:pointer; }
    .same-address label { margin:0; cursor:pointer; font-size:.88rem; font-weight:700; color:var(--g1); }

    /* ‚îÄ‚îÄ MAP RESULT ‚îÄ‚îÄ */
    #map-result {
      margin-top:1.2rem; padding:1.1rem;
      background:linear-gradient(135deg,var(--light),#e8f4ff);
      border:1.5px solid var(--border); border-left:4px solid var(--b1);
      border-radius:10px; display:none;
    }
    .map-title { font-weight:800; color:var(--b2); margin-bottom:.6rem; font-size:.9rem; font-family:'Nunito',sans-serif; }
    .map-branch {
      display:flex; align-items:flex-start; gap:.6rem;
      margin-bottom:.5rem; font-size:.84rem;
      padding:.5rem .6rem; border-radius:8px; transition:background .15s;
    }
    .map-branch.best { background:rgba(26,122,46,.07); border:1px solid rgba(26,122,46,.2); }
    .map-dist { color:var(--muted); font-size:.76rem; margin-left:auto; white-space:nowrap; font-weight:600; }

    /* ‚îÄ‚îÄ SUMMARY ‚îÄ‚îÄ */
    .summary-row { display:flex; justify-content:space-between; align-items:center; padding:.7rem 0; border-bottom:1.5px solid var(--light); font-size:.9rem; }
    .summary-row:last-child { border-bottom:none; }
    .summary-key { color:var(--muted); font-weight:600; }
    .summary-val { font-weight:800; color:var(--text); text-align:right; max-width:58%; font-family:'Nunito',sans-serif; }
    .price-box {
      margin-top:1.6rem; padding:1.4rem;
      background:linear-gradient(135deg,var(--g1) 0%,var(--b2) 100%);
      border-radius:14px; color:white; text-align:center;
    }
    .price-label { font-size:.82rem; opacity:.75; margin-bottom:.2rem; font-weight:600; }
    .price-amount { font-family:'Nunito',sans-serif; font-size:2.2rem; font-weight:900; color:var(--g2); }
    .price-note   { font-size:.73rem; opacity:.6; margin-top:.3rem; }
    .price-cols { display:flex; justify-content:center; gap:2.5rem; margin:.6rem 0; }
    .price-col { text-align:center; }
    .price-col-val { font-family:'Nunito',sans-serif; font-size:1.2rem; font-weight:900; }

    /* ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ */
    .btn-row { display:flex; gap:.9rem; margin-top:1.8rem; }
    .btn { padding:.82rem 1.8rem; border-radius:999px; border:none; font-size:.93rem; font-weight:800; cursor:pointer; transition:all .2s; flex:1; font-family:'Nunito',sans-serif; }
    .btn-primary {
      background:linear-gradient(135deg,var(--g1),var(--g2));
      color:white; box-shadow:0 4px 18px rgba(26,122,46,.35);
    }
    .btn-primary:hover { transform:translateY(-2px); box-shadow:0 7px 24px rgba(26,122,46,.45); }
    .btn-secondary { background:var(--light); color:var(--text); border:2px solid var(--border); }
    .btn-secondary:hover { background:#e0ede3; }

    /* ‚îÄ‚îÄ SUCCESS ‚îÄ‚îÄ */
    #success-screen { display:none; text-align:center; padding:3rem 1.5rem 5rem; }
    .success-icon { font-size:5rem; margin-bottom:1rem; animation:popIn .5s cubic-bezier(.34,1.56,.64,1); }
    @keyframes popIn { from{opacity:0;transform:scale(.4)} to{opacity:1;transform:scale(1)} }
    #success-screen h2 { font-family:'Nunito',sans-serif; font-size:2.2rem; font-weight:900; color:var(--g1); margin-bottom:.8rem; font-style:italic; }
    #success-screen p { color:var(--muted); font-size:1rem; max-width:420px; margin:0 auto 1.8rem; line-height:1.75; font-weight:600; }
    .order-code {
      display:inline-block; background:var(--g1); color:var(--g2);
      font-family:monospace; font-size:1.4rem; font-weight:800;
      padding:.65rem 1.6rem; border-radius:10px; letter-spacing:.12em;
      box-shadow:0 4px 18px rgba(26,122,46,.25);
    }

    /* ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ */
    footer {
      background:var(--g1); color:rgba(255,255,255,.6);
      text-align:center; padding:2rem 1rem; font-size:.8rem;
    }
    .footer-logo { font-family:'Nunito',sans-serif; font-size:1.2rem; font-weight:900; font-style:italic; color:white; margin-bottom:.3rem; }
    .footer-slogan { color:var(--b1); font-weight:700; font-size:.78rem; letter-spacing:.08em; margin-bottom:.6rem; }
    footer p { color:rgba(255,255,255,.45); }

    /* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
    .toast {
      position:fixed; bottom:1.5rem; right:1.5rem; z-index:9999;
      background:#c0392b; color:white; padding:.9rem 1.4rem; border-radius:10px;
      font-size:.88rem; font-weight:700; box-shadow:0 6px 20px rgba(0,0,0,.2);
      transform:translateY(20px); opacity:0; transition:all .3s; pointer-events:none;
      font-family:'Nunito',sans-serif;
    }
    .toast.show { transform:none; opacity:1; }

    @media(max-width:520px) {
      .slogan-hero { flex-direction:column; }
      .slogan-part:first-child { border-radius:8px 8px 0 0; }
      .slogan-part:last-child { border-radius:0 0 8px 8px; }
    }
  </style>
</head>
<body>

<!-- NAV -->
<nav>
  <div class="logo-wrap">
    <div class="logo-icon-wrap">
      <svg class="logo-svg" viewBox="0 0 80 80" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="40" cy="40" r="38" fill="white"/>
        <path d="M40 10 C22 10 8 24 8 42 C8 56 18 68 32 72 L36 60 C26 57 20 50 20 42 C20 30 29 21 40 21 C45 21 50 23 54 27 L46 30 L64 40 L58 22 L50 26 C45 21 43 19 40 18Z" fill="#4cbb3a"/>
        <path d="M40 70 C58 70 72 56 72 38 C72 24 62 12 48 8 L44 20 C54 23 60 30 60 38 C60 50 51 59 40 59 C35 59 30 57 26 53 L34 50 L16 40 L22 58 L30 54 C35 59 37 61 40 62Z" fill="#1a3a6b"/>
        <!-- botella verde -->
        <rect x="28" y="28" width="10" height="28" rx="3" fill="#1a7a2e"/>
        <rect x="30" y="24" width="6" height="6" rx="1.5" fill="#1a7a2e"/>
        <!-- botella azul -->
        <rect x="42" y="25" width="10" height="31" rx="3" fill="#1a3a6b"/>
        <rect x="44" y="21" width="6" height="6" rx="1.5" fill="#1a3a6b"/>
      </svg>
    </div>
    <div>
      <div class="logo-name">Ret<span>√≥</span>rname<span style="color:var(--g2)">.</span></div>
    </div>
  </div>
  <div style="text-align:right">
    <div class="nav-slogan">Recoge ¬∑ Retorna ¬∑ Reparte</div>
  </div>
  <span class="beta-tag">Beta</span>
</nav>

<!-- HERO -->
<section class="hero">
  <div class="hero-bottles"></div>
  <div class="hero-tag">üå± Econom√≠a circular en tu puerta</div>
  <h1>Tus botellas vuelven<br>convertidas en <span class="accent">bebidas</span> <span class="accent2">frescas</span></h1>
  <div class="slogan-hero">
    <div class="slogan-part">Recoge</div>
    <div class="slogan-part">Retorna</div>
    <div class="slogan-part">Reparte</div>
  </div><br>
  <p>Retiramos tus botellas vac√≠as, las devolvemos al supermercado y te traemos las bebidas que elijas ‚Äî t√∫ no te mueves.</p>
  <a href="#form-section" class="hero-cta">‚ôªÔ∏è &nbsp;Solicitar retiro ahora ‚Üí</a>
</section>

<!-- STEPS BAR -->
<div class="steps-bar">
  <div class="steps-track">
    <div class="step-item active" id="step-ind-1"><div class="step-dot">1</div><div class="step-label">Supermercado</div></div>
    <div class="step-item" id="step-ind-2"><div class="step-dot">2</div><div class="step-label">Botellas</div></div>
    <div class="step-item" id="step-ind-3"><div class="step-dot">3</div><div class="step-label">Bebidas</div></div>
    <div class="step-item" id="step-ind-4"><div class="step-dot">4</div><div class="step-label">Direcci√≥n</div></div>
    <div class="step-item" id="step-ind-5"><div class="step-dot">5</div><div class="step-label">Resumen</div></div>
  </div>
</div>

<!-- FORM -->
<div id="form-section" class="form-container">

  <!-- PASO 1 -->
  <div class="card visible" id="card-1">
    <div class="card-header">
      <div class="card-num">1</div>
      <div><div class="card-title">Elige el supermercado</div><div class="card-sub">Selecciona la cadena donde canjearemos tus botellas</div></div>
    </div>
    <div class="super-grid" id="super-grid"></div>
    <div class="btn-row"><button class="btn btn-primary" onclick="goStep(2)">Continuar ‚Üí</button></div>
  </div>

  <!-- PASO 2 -->
  <div class="card" id="card-2">
    <div class="card-header">
      <div class="card-num">2</div>
      <div><div class="card-title">¬øCu√°ntas botellas retornas?</div><div class="card-sub">Solo se aceptan botellas retornables con s√≠mbolo ‚ôªÔ∏è</div></div>
    </div>
    <div class="counter-row">
      <button class="counter-btn" onclick="changeBottles(-1)">‚àí</button>
      <div class="counter-display" id="bottle-count">0</div>
      <button class="counter-btn" onclick="changeBottles(1)">+</button>
      <div class="counter-label">botellas</div>
    </div>
    <div class="bottles-info" id="bottles-info" style="display:none"></div>
    <div class="btn-row">
      <button class="btn btn-secondary" onclick="goStep(1)">‚Üê Atr√°s</button>
      <button class="btn btn-primary" onclick="goStep(3)">Continuar ‚Üí</button>
    </div>
  </div>

  <!-- PASO 3 -->
  <div class="card" id="card-3">
    <div class="card-header">
      <div class="card-num">3</div>
      <div><div class="card-title">¬øQu√© bebidas quieres de vuelta?</div><div class="card-sub">Elige hasta 3 opciones en orden de preferencia por si no hay stock</div></div>
    </div>
    <div class="bev-legend">
      <div class="legend-item"><div class="legend-dot" style="background:var(--g1)"></div> 1¬™ opci√≥n</div>
      <div class="legend-item"><div class="legend-dot" style="background:var(--b1)"></div> 2¬™ opci√≥n</div>
      <div class="legend-item"><div class="legend-dot" style="background:var(--b2)"></div> 3¬™ opci√≥n</div>
    </div>
    <div id="bev-groups"></div>
    <div class="btn-row">
      <button class="btn btn-secondary" onclick="goStep(2)">‚Üê Atr√°s</button>
      <button class="btn btn-primary" onclick="goStep(4)">Continuar ‚Üí</button>
    </div>
  </div>

  <!-- PASO 4 -->
  <div class="card" id="card-4">
    <div class="card-header">
      <div class="card-num">4</div>
      <div><div class="card-title">Direcci√≥n de retiro y entrega</div><div class="card-sub">Zona de servicio: Las Condes, Vitacura y Lo Barnechea</div></div>
    </div>
    <div class="address-block">
      <label><span class="address-icon">üì¶</span>Direcci√≥n de retiro</label>
      <div class="hint">Calle, n√∫mero, comuna ‚Äì Ej: Av. Las Condes 10000, Las Condes</div>
      <input type="text" id="pickup-addr" placeholder="Av. Las Condes 10000, Las Condes"/>
    </div>
    <div class="same-address">
      <input type="checkbox" id="same-chk" onchange="toggleSameAddr()"/>
      <label for="same-chk">La entrega es en la misma direcci√≥n de retiro</label>
    </div>
    <div id="delivery-block" class="address-block" style="margin-top:1.2rem">
      <label><span class="address-icon">üè†</span>Direcci√≥n de entrega</label>
      <div class="hint">Puede ser diferente al punto de retiro</div>
      <input type="text" id="delivery-addr" placeholder="Av. Vitacura 4000, Vitacura"/>
    </div>
    <button class="btn btn-primary" style="width:100%;margin-top:1rem" onclick="findBranch()">
      üó∫Ô∏è Encontrar sucursal m√°s cercana
    </button>
    <div id="map-result">
      <div class="map-title">üìç Sucursal asignada autom√°ticamente</div>
      <div id="branch-info"></div>
    </div>
    <div class="btn-row">
      <button class="btn btn-secondary" onclick="goStep(3)">‚Üê Atr√°s</button>
      <button class="btn btn-primary" onclick="goStep(5)">Continuar ‚Üí</button>
    </div>
  </div>

  <!-- PASO 5 -->
  <div class="card" id="card-5">
    <div class="card-header">
      <div class="card-num">5</div>
      <div><div class="card-title">Resumen del pedido</div><div class="card-sub">Revisa todo antes de confirmar</div></div>
    </div>
    <div id="summary-content"></div>
    <div class="btn-row">
      <button class="btn btn-secondary" onclick="goStep(4)">‚Üê Atr√°s</button>
      <button class="btn btn-primary" onclick="confirmOrder()">‚úÖ Confirmar pedido</button>
    </div>
  </div>

</div>

<!-- SUCCESS -->
<div id="success-screen">
  <div class="success-icon">üéâ</div>
  <h2>¬°Pedido confirmado!</h2>
  <p>Nos pondremos en contacto para coordinar el retiro. Recibir√°s tus bebidas en el horario acordado.</p>
  <div class="order-code" id="order-code">RT-000000</div><br><br>
  <button class="btn btn-primary" style="display:inline-block;width:auto;padding:.9rem 2.2rem" onclick="newOrder()">Hacer otro pedido</button>
</div>

<footer>
  <div class="footer-logo">Ret√≥rname.</div>
  <div class="footer-slogan">RECOGE ¬∑ RETORNA ¬∑ REPARTE</div>
  <p>¬© 2025 Ret√≥rname SpA ¬∑ Versi√≥n Beta ¬∑ Hecho en Chile con üíö</p>
</footer>

<div class="toast" id="toast"></div>

<script>
/* ‚îÄ‚îÄ DATOS ‚îÄ‚îÄ */
const SUPERMARKETS = [
  {id:'jumbo',    name:'Jumbo',         icon:'üõí'},
  {id:'unimarc',  name:'Unimarc',       icon:'üè™'},
  {id:'lider',    name:'L√≠der',         icon:'üè¨'},
  {id:'tottus',   name:'Tottus',        icon:'üõçÔ∏è'},
  {id:'acuenta',  name:'Acuenta',       icon:'üí∞'},
  {id:'mayorista',name:'Mayorista 10',  icon:'üì¶'},
];

const BEVERAGES = {
  'Gaseosas':[
    {id:'coca',   name:'Coca-Cola', icon:'ü•§'},
    {id:'pepsi',  name:'Pepsi',     icon:'ü•§'},
    {id:'sprite', name:'Sprite',    icon:'ü•§'},
    {id:'fanta',  name:'Fanta',     icon:'üçä'},
    {id:'bilz',   name:'Bilz',      icon:'üçã'},
    {id:'pap',    name:'Pap',       icon:'üçé'},
  ],
  'Aguas':[
    {id:'villarica', name:'Villarrica', icon:'üíß'},
    {id:'cachantun', name:'Cachant√∫n',  icon:'üíß'},
    {id:'porvenir',  name:'Porvenir',   icon:'üíß'},
  ],
  'Jugos y otros':[
    {id:'kem',   name:'Kem',   icon:'üçπ'},
    {id:'watts', name:'Watts', icon:'üßÉ'},
    {id:'andina',name:'Andina',icon:'ü•õ'},
  ],
};

/*
  SUCURSALES: solo Las Condes, Vitacura y Lo Barnechea
  Coordenadas reales aproximadas
*/
const BRANCHES = {
  jumbo:[
    {name:'Jumbo Apoquindo',         addr:'Av. Apoquindo 8601, Las Condes',           lat:-33.409,lng:-70.530,comuna:'Las Condes'},
    {name:'Jumbo Kennedy',           addr:'Av. Kennedy 9001, Las Condes',             lat:-33.393,lng:-70.540,comuna:'Las Condes'},
    {name:'Jumbo Vitacura',          addr:'Av. Vitacura 5250, Vitacura',              lat:-33.388,lng:-70.574,comuna:'Vitacura'},
    {name:'Jumbo Lo Barnechea',      addr:'Av. La Dehesa 1445, Lo Barnechea',         lat:-33.352,lng:-70.513,comuna:'Lo Barnechea'},
  ],
  unimarc:[
    {name:'Unimarc Las Condes',      addr:'Av. Las Condes 13451, Las Condes',         lat:-33.375,lng:-70.496,comuna:'Las Condes'},
    {name:'Unimarc El Golf',         addr:'Av. El Golf 150, Las Condes',              lat:-33.413,lng:-70.589,comuna:'Las Condes'},
    {name:'Unimarc Vitacura',        addr:'Av. Vitacura 3800, Vitacura',              lat:-33.392,lng:-70.585,comuna:'Vitacura'},
    {name:'Unimarc Lo Barnechea',    addr:'Av. Los Militares 5850, Lo Barnechea',     lat:-33.363,lng:-70.506,comuna:'Lo Barnechea'},
  ],
  lider:[
    {name:'L√≠der Express Las Condes',addr:'Av. Apoquindo 4501, Las Condes',           lat:-33.410,lng:-70.554,comuna:'Las Condes'},
    {name:'L√≠der Express Vitacura',  addr:'Av. Bicentenario 3750, Vitacura',          lat:-33.385,lng:-70.570,comuna:'Vitacura'},
  ],
  tottus:[
    {name:'Tottus Las Condes',       addr:'Av. Presidente Kennedy 5413, Las Condes', lat:-33.400,lng:-70.553,comuna:'Las Condes'},
  ],
  acuenta:[
    {name:'Acuenta Las Condes',      addr:'Av. Las Condes 9900, Las Condes',          lat:-33.385,lng:-70.523,comuna:'Las Condes'},
    {name:'Acuenta Vitacura',        addr:'Av. Nueva Costanera 3698, Vitacura',       lat:-33.394,lng:-70.568,comuna:'Vitacura'},
  ],
  mayorista:[
    {name:'Mayorista 10 Las Condes', addr:'Av. Apoquindo 7300, Las Condes',           lat:-33.407,lng:-70.538,comuna:'Las Condes'},
  ],
};

/* ‚îÄ‚îÄ ESTADO ‚îÄ‚îÄ */
let state={supermarket:null,bottles:0,beverages:[],pickupAddr:'',deliveryAddr:'',branch:null};
let currentStep=1;

(function init(){buildSuperGrid();buildBevGroups();})();

function buildSuperGrid(){
  document.getElementById('super-grid').innerHTML=SUPERMARKETS.map(s=>`
    <div class="super-card" id="sc-${s.id}" onclick="selectSuper('${s.id}')">
      <div class="super-icon">${s.icon}</div>
      <div class="super-name">${s.name}</div>
      <div class="super-check">‚úì seleccionado</div>
    </div>`).join('');
}

function buildBevGroups(){
  let html='';
  for(const[cat,items]of Object.entries(BEVERAGES)){
    html+=`<div class="bev-group">
      <div class="bev-group-label">${cat}</div>
      <div class="bev-grid">${items.map(b=>`
        <div class="bev-card" id="bc-${b.id}" onclick="pickBev('${b.id}','${b.name}','${b.icon}')">
          <div class="bev-icon">${b.icon}</div>
          <div class="bev-name">${b.name}</div>
        </div>`).join('')}</div>
    </div>`;
  }
  document.getElementById('bev-groups').innerHTML=html;
}

/* ‚îÄ‚îÄ NAVEGACI√ìN ‚îÄ‚îÄ */
function goStep(n){
  if(!validateStep(currentStep))return;
  document.getElementById(`card-${currentStep}`).classList.remove('visible');
  document.getElementById(`step-ind-${currentStep}`).classList.remove('active');
  document.getElementById(`step-ind-${currentStep}`).classList.add('completed');
  if(n<currentStep){
    for(let i=n;i<=5;i++) document.getElementById(`step-ind-${i}`).classList.remove('completed','active');
  }
  currentStep=n;
  document.getElementById(`card-${n}`).classList.add('visible');
  document.getElementById(`step-ind-${n}`).classList.add('active');
  document.getElementById(`step-ind-${n}`).classList.remove('completed');
  if(n===5)buildSummary();
  document.getElementById('form-section').scrollIntoView({behavior:'smooth',block:'start'});
}

function validateStep(n){
  if(n===1&&!state.supermarket){showToast('Por favor selecciona un supermercado.');return false;}
  if(n===2&&state.bottles<1){showToast('Debes ingresar al menos 1 botella.');return false;}
  if(n===3&&state.beverages.length<1){showToast('Elige al menos 1 bebida de preferencia.');return false;}
  if(n===4){
    const pa=document.getElementById('pickup-addr').value.trim();
    const da=document.getElementById('delivery-addr').value.trim();
    if(!pa){showToast('Ingresa la direcci√≥n de retiro.');return false;}
    if(!da){showToast('Ingresa la direcci√≥n de entrega.');return false;}
    state.pickupAddr=pa; state.deliveryAddr=da;
  }
  return true;
}

/* ‚îÄ‚îÄ PASO 1 ‚îÄ‚îÄ */
function selectSuper(id){
  document.querySelectorAll('.super-card').forEach(c=>c.classList.remove('selected'));
  document.getElementById(`sc-${id}`).classList.add('selected');
  state.supermarket=id;
}

/* ‚îÄ‚îÄ PASO 2 ‚îÄ‚îÄ */
function changeBottles(delta){
  state.bottles=Math.max(0,state.bottles+delta);
  document.getElementById('bottle-count').textContent=state.bottles;
  const info=document.getElementById('bottles-info');
  if(state.bottles>0){
    const val=state.bottles*130;
    info.style.display='block';
    info.innerHTML=`üí∞ Valor estimado de retorno: <strong>$${val.toLocaleString('es-CL')} CLP</strong>&nbsp; ¬∑ &nbsp;üå± <strong>${(state.bottles*0.3).toFixed(1)}L</strong> de agua reciclada`;
  } else info.style.display='none';
}

/* ‚îÄ‚îÄ PASO 3 ‚îÄ‚îÄ */
function pickBev(id,name,icon){
  const ex=state.beverages.find(b=>b.id===id);
  if(ex){state.beverages=state.beverages.filter(b=>b.id!==id);}
  else{
    if(state.beverages.length>=3){showToast('M√°ximo 3 opciones de preferencia.');return;}
    state.beverages.push({id,name,icon,pick:state.beverages.length+1});
  }
  rebuildBevPicks();
}
function rebuildBevPicks(){
  document.querySelectorAll('.bev-card').forEach(c=>{
    c.className='bev-card';
    const b=c.querySelector('.bev-badge');
    if(b)b.remove();
  });
  state.beverages.forEach((b,i)=>{
    b.pick=i+1;
    const card=document.getElementById(`bc-${b.id}`);
    card.classList.add(`pick-${b.pick}`);
    const badge=document.createElement('div');
    badge.className='bev-badge'; badge.textContent=b.pick;
    card.appendChild(badge);
  });
}

/* ‚îÄ‚îÄ PASO 4: ALGORITMO HAVERSINE ‚îÄ‚îÄ */
function toggleSameAddr(){
  const chk=document.getElementById('same-chk').checked;
  document.getElementById('delivery-block').style.display=chk?'none':'block';
  if(chk) document.getElementById('delivery-addr').value=document.getElementById('pickup-addr').value;
}

function haversine(lat1,lng1,lat2,lng2){
  const R=6371,dLat=(lat2-lat1)*Math.PI/180,dLng=(lng2-lng1)*Math.PI/180;
  const a=Math.sin(dLat/2)**2+Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLng/2)**2;
  return R*2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
}

/* Geocodificaci√≥n por nombre de sector (Las Condes, Vitacura, Lo Barnechea) */
function geocodeSim(addr){
  const a=addr.toLowerCase();
  const map=[
    /* Lo Barnechea */
    ['lo barnechea',-33.352,-70.513],['la dehesa',-33.345,-70.498],
    ['los dominicos',-33.360,-70.510],['san carlos de apoquindo',-33.340,-70.495],
    /* Vitacura */
    ['vitacura',-33.388,-70.574],['nueva costanera',-33.394,-70.568],
    ['bicentenario',-33.385,-70.570],['los militares',-33.395,-70.560],
    ['manquehue',-33.390,-70.562],
    /* Las Condes (sectores) */
    ['apoquindo',-33.410,-70.545],['el golf',-33.413,-70.590],
    ['tobalaba',-33.412,-70.576],['kennedy',-33.400,-70.553],
    ['estoril',-33.405,-70.548],['la reina',-33.452,-70.563], /* lim√≠trofe */
    ['las condes',-33.400,-70.540],
  ];
  for(const[name,lat,lng]of map){if(a.includes(name))return{lat,lng};}
  return{lat:-33.400,lng:-70.545}; /* centro aprox. zona */
}

function findBranch(){
  const pa=document.getElementById('pickup-addr').value.trim();
  let da=document.getElementById('delivery-addr').value.trim();
  if(!pa){showToast('Ingresa la direcci√≥n de retiro primero.');return;}
  if(!da||document.getElementById('same-chk').checked){da=pa;document.getElementById('delivery-addr').value=pa;}
  state.pickupAddr=pa; state.deliveryAddr=da;
  const branches=BRANCHES[state.supermarket]||[];
  if(!branches.length){showToast('No hay sucursales registradas para este supermercado en la zona.');return;}
  const pC=geocodeSim(pa), dC=geocodeSim(da);
  const ranked=branches.map(b=>({
    ...b,
    score:(haversine(pC.lat,pC.lng,b.lat,b.lng)+haversine(dC.lat,dC.lng,b.lat,b.lng))/2
  })).sort((a,b)=>a.score-b.score);
  state.branch=ranked[0];
  document.getElementById('map-result').style.display='block';
  document.getElementById('branch-info').innerHTML=ranked.map((b,i)=>`
    <div class="map-branch${i===0?' best':''}">
      <span>${['üèÜ','ü•à','ü•â'][i]||'‚Ä¢'}</span>
      <span>
        <strong>${b.name}</strong>
        <span style="display:inline-block;margin-left:.4rem;font-size:.7rem;background:${i===0?'var(--g1)':'var(--b2)'};color:white;padding:.1rem .5rem;border-radius:4px;font-weight:700">${b.comuna}</span>
        <br><small style="color:var(--muted)">${b.addr}</small>
      </span>
      <span class="map-dist">${b.score.toFixed(1)} km</span>
    </div>`).join('');
}

/* ‚îÄ‚îÄ PASO 5 ‚îÄ‚îÄ */
function buildSummary(){
  const sm=SUPERMARKETS.find(s=>s.id===state.supermarket);
  const bevList=state.beverages.map((b,i)=>`${['1¬™','2¬™','3¬™'][i]} opci√≥n: ${b.icon} ${b.name}`).join('<br>');
  const val=state.bottles*130, service=1490, total=Math.max(0,val-service);
  const br=state.branch?`${state.branch.name}<br><small style="font-weight:600;color:var(--muted)">${state.branch.addr}</small>`:'Por determinar';
  document.getElementById('summary-content').innerHTML=`
    <div class="summary-row"><span class="summary-key">Supermercado</span><span class="summary-val">${sm?.icon} ${sm?.name}</span></div>
    <div class="summary-row"><span class="summary-key">Botellas a retornar</span><span class="summary-val">${state.bottles} botella${state.bottles!==1?'s':''}</span></div>
    <div class="summary-row"><span class="summary-key">Valor estimado de retorno</span><span class="summary-val">$${val.toLocaleString('es-CL')} CLP</span></div>
    <div class="summary-row"><span class="summary-key">Preferencias de bebidas</span><span class="summary-val" style="line-height:1.7">${bevList}</span></div>
    <div class="summary-row"><span class="summary-key">Direcci√≥n de retiro</span><span class="summary-val">${state.pickupAddr}</span></div>
    <div class="summary-row"><span class="summary-key">Direcci√≥n de entrega</span><span class="summary-val">${state.deliveryAddr}</span></div>
    <div class="summary-row"><span class="summary-key">Sucursal asignada</span><span class="summary-val">${br}</span></div>
    <div class="price-box">
      <div class="price-cols">
        <div class="price-col"><div class="price-label">Retorno botellas</div><div class="price-col-val" style="color:var(--g2)">+$${val.toLocaleString('es-CL')}</div></div>
        <div class="price-col"><div class="price-label">Servicio Ret√≥rname</div><div class="price-col-val" style="color:#f87171">-$${service.toLocaleString('es-CL')}</div></div>
      </div>
      <div class="price-label" style="margin-top:.8rem">Saldo disponible en bebidas</div>
      <div class="price-amount">$${total.toLocaleString('es-CL')} CLP</div>
      <div class="price-note">* Precio estimado. El valor final depende del stock en tienda.</div>
    </div>`;
}

function confirmOrder(){
  const code='RT-'+Math.floor(100000+Math.random()*900000);
  document.getElementById('order-code').textContent=code;
  document.getElementById('form-section').style.display='none';
  document.getElementById('success-screen').style.display='block';
  window.scrollTo({top:0,behavior:'smooth'});
}

function newOrder(){
  state={supermarket:null,bottles:0,beverages:[],pickupAddr:'',deliveryAddr:'',branch:null};
  currentStep=1;
  document.querySelectorAll('.card').forEach(c=>c.classList.remove('visible'));
  document.getElementById('card-1').classList.add('visible');
  for(let i=1;i<=5;i++) document.getElementById(`step-ind-${i}`).classList.remove('active','completed');
  document.getElementById('step-ind-1').classList.add('active');
  buildSuperGrid(); buildBevGroups();
  document.getElementById('bottle-count').textContent='0';
  document.getElementById('bottles-info').style.display='none';
  document.getElementById('pickup-addr').value='';
  document.getElementById('delivery-addr').value='';
  document.getElementById('map-result').style.display='none';
  document.getElementById('form-section').style.display='block';
  document.getElementById('success-screen').style.display='none';
  window.scrollTo({top:0,behavior:'smooth'});
}

function showToast(msg){
  const t=document.getElementById('toast');
  t.textContent=msg; t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),3200);
}
</script>
</body>
</html>
